---
description: Create or update Kiro steering documents intelligently based on project state
allowed-tools: Bash, Read, Write, Edit, MultiEdit, Glob, Grep, LS
---

# 仕様ステアリング管理

`spec/steering/`にステアリング文書をインテリジェントに作成または更新し、仕様駆動開発のための正確なプロジェクト知識を維持します。このコマンドは既存の文書を検出し、適切に処理します。

## 既存ファイルのチェック

### 現在のステアリング文書ステータス

- プロダクト概要: !`[ -f "spec/steering/product.md" ] && echo "✅ 存在 - カスタムコンテンツを保持して更新されます" || echo "📝 見つかりません - 作成されます"`
- 技術スタック: !`[ -f "spec/steering/tech.md" ] && echo "✅ 存在 - カスタムコンテンツを保持して更新されます" || echo "📝 見つかりません - 作成されます"`
- プロジェクト構造: !`[ -f "spec/steering/structure.md" ] && echo "✅ 存在 - カスタムコンテンツを保持して更新されます" || echo "📝 見つかりません - 作成されます"`
- カスタムステアリングファイル: !`if [ -d "spec/steering" ]; then count=$(find spec/steering -maxdepth 1 -type f -name '*.md' ! -name 'product.md' ! -name 'tech.md' ! -name 'structure.md' | grep -c .); if [ "$count" -gt 0 ]; then echo "🔧 $count個のカスタムファイルが見つかりました - 保持されます"; else echo "📋 カスタムファイルなし"; fi; else echo "📋 ステアリングディレクトリはまだありません"; fi`

## プロジェクト分析

### 現在のプロジェクト状態

- プロジェクトファイル: !`find . -path ./node_modules -prune -o -path ./.git -prune -o -path ./dist -prune -o -type f \( -name "*.py" -o -name "*.js" -o -name "*.ts" -o -name "*.jsx" -o -name "*.tsx" -o -name "*.java" -o -name "*.go" -o -name "*.rs" \) -print 2>/dev/null || echo "ソースファイルが見つかりません"`
- 設定ファイル: !`find . -maxdepth 3 \( -name "package.json" -o -name "requirements.txt" -o -name "pom.xml" -o -name "Cargo.toml" -o -name "go.mod" -o -name "pyproject.toml" -o -name "tsconfig.json" \) 2>/dev/null || echo "設定ファイルが見つかりません"`
- ドキュメント: !`find . -maxdepth 3 -path ./node_modules -prune -o -path ./.git -prune -o -path ./spec -prune -o \( -name "README*" -o -name "CHANGELOG*" -o -name "LICENSE*" -o -name "*.md" \) -print 2>/dev/null || echo "ドキュメントファイルが見つかりません"`

### 最近の変更（更新の場合）

- 最後のステアリング更新: !`git log -1 --oneline -- spec/steering/ 2>/dev/null || echo "以前のステアリングコミットなし"`
- 最後のステアリング更新以降のコミット: !`LAST_COMMIT=$(git log -1 --format=%H -- spec/steering/ 2>/dev/null); if [ -n "$LAST_COMMIT" ]; then git log --oneline ${LAST_COMMIT}..HEAD --max-count=20 2>/dev/null || echo "gitリポジトリではありません"; else echo "以前のステアリング更新が見つかりません"; fi`
- ワーキングツリーステータス: !`git status --porcelain 2>/dev/null || echo "gitリポジトリではありません"`

### 既存のドキュメント

- メインREADME: @README.md
- パッケージ設定: @package.json
- Python要件: @requirements.txt
- TypeScript設定: @tsconfig.json
- プロジェクトドキュメント: @docs/

## スマート更新戦略

上記の既存ファイルチェックに基づいて、このコマンドは以下を実行します：

### 新しいファイル（"📝 見つかりません"を示す）:

プロジェクトのすべての側面をカバーする包括的な初期コンテンツを生成します。

### 既存ファイル（"✅ 存在"を示す）:

1. **ユーザーカスタマイゼーションを保持** - 手動編集やカスタムセクション
2. **事実情報を更新** - 依存関係、ファイル構造、コマンド
3. **新しいセクションを追加** - 重要な新機能が存在する場合のみ
4. **非推奨コンテンツをマーク** - 削除ではなく
5. **フォーマットを維持** - 既存のスタイルと一貫性を保つ

## コアステアリングファイルのインクルードモード

3つのコアステアリングファイル（product.md、tech.md、structure.md）は**常にインクルード**されるように設計されており、一貫したプロジェクトコンテキストを提供するためにすべてのAIインタラクションで読み込まれます。

### インクルードモードの理解

- **常にインクルード（コアファイルのデフォルト）**: すべてのインタラクションで読み込まれる - 一貫したプロジェクト知識を確保
- **条件付き**: 一致するファイルパターンで作業する場合のみ読み込まれる（主にカスタムステアリング用）
- **手動**: @filename構文でオンデマンドで参照される（専門コンテキスト用）

### コアファイル戦略

- `product.md`: 常に - すべての開発決定にビジネスコンテキストが必要
- `tech.md`: 常に - 技術的制約がすべてのコード生成に影響
- `structure.md`: 常に - アーキテクチャ決定がすべてのファイル組織に影響

## タスク: ステアリング文書の作成または更新

### 1. プロダクト概要（`product.md`）

#### 新しいファイルの場合：

以下を含む包括的なプロダクト概要を生成：

- **プロダクト概要**: プロダクトが何であるかの簡潔な説明
- **コア機能**: 主要機能の箇条書きリスト
- **ターゲットユースケース**: プロダクトが対処する特定のシナリオ
- **主要価値提案**: 独自の利益と差別化要因

#### 既存ファイルの場合：

以下がある場合のみ更新：

- プロダクトに追加された**新機能**
- **削除された機能**または非推奨機能
- **変更されたユースケース**またはターゲットオーディエンス
- **更新された価値提案**または利益

### 2. 技術スタック（`tech.md`）

#### 新しいファイルの場合：

完全な技術ランドスケープを文書化：

- **アーキテクチャ**: 高レベルシステム設計
- **フロントエンド**: フレームワーク、ライブラリ、ビルドツール（該当する場合）
- **バックエンド**: 言語、フレームワーク、サーバー技術（該当する場合）
- **開発環境**: 必要なツールとセットアップ
- **共通コマンド**: 頻繁に使用される開発コマンド
- **環境変数**: 主要な設定変数
- **ポート設定**: サービスで使用される標準ポート

#### 既存ファイルの場合：

以下の変更をチェック：

- パッケージマネージャー経由で追加された**新しい依存関係**
- **削除されたライブラリ**またはフレームワーク
- 主要依存関係の**バージョンアップグレード**
- **新しい開発ツール**またはビルドプロセス
- **変更された環境変数**または設定
- **変更されたポート割り当て**またはサービスアーキテクチャ

### 3. プロジェクト構造（`structure.md`）

#### 新しいファイルの場合：

コードベース組織の概要：

- **ルートディレクトリ組織**: 説明付きのトップレベル構造
- **サブディレクトリ構造**: 主要ディレクトリの詳細な内訳
- **コード組織パターン**: コードの構造化方法
- **ファイル命名規則**: ファイルとディレクトリの命名標準
- **インポート組織**: インポート/依存関係の組織化方法
- **主要アーキテクチャ原則**: コア設計決定とパターン

#### 既存ファイルの場合：

以下の変更を探す：

- **新しいディレクトリ**または主要な再編成
- **変更されたファイル組織**パターン
- **新しいまたは変更された命名規則**
- **更新されたアーキテクチャパターン**または原則
- **リファクタリングされたコード構造**またはモジュール境界

### 4. カスタムステアリングファイル

カスタムステアリングファイルが存在する場合：

- **保持する** - 特に時代遅れでない限り変更しない
- **関連性をチェック** - 削除された機能を参照しているかメモ
- **新しいカスタムファイルを提案** - 新しい専門分野が出現した場合

## 指示

1. 存在しない場合は**`spec/steering/`ディレクトリを作成**
2. 作成 vs 更新モードを決定するために**既存ファイルをチェック**
3. ネイティブツール（Glob、Grep、LS）を使用して**コードベースを分析**
4. **新しいファイルの場合**: 包括的な初期ドキュメントを生成
5. **既存ファイルの場合**:
   - 最初に現在のコンテンツを読む
   - ユーザーカスタマイゼーションとコメントを保持
   - 事実/技術情報のみを更新
   - 既存の構造とスタイルを維持
6. 適切なヘッダーとセクションで**明確なマークダウンフォーマットを使用**
7. 理解に役立つ場合は**具体例を含める**
8. **仮定より事実に焦点** - 存在するものを文書化
9. **仕様駆動開発原則に従う**

## 重要な原則

### セキュリティガイドライン

- **機密データを含めない**: APIキー、パスワード、データベース認証情報、個人情報なし
- **コミット前にレビュー**: バージョン管理前にステアリングコンテンツを常にレビュー
- **チーム共有の考慮**: ステアリングファイルはすべてのプロジェクト協力者と共有されることを忘れない

### コンテンツ品質ガイドライン

- **単一ドメイン焦点**: 各ステアリングファイルは一つの特定分野をカバーすべき
- **明確で説明的なコンテンツ**: 具体例と決定の根拠を提供
- **定期的なメンテナンス**: 主要プロジェクト変更後にステアリングファイルをレビューおよび更新
- **実行可能なガイダンス**: 抽象的な原則ではなく特定の実装可能なガイドラインを記述

### 保持戦略

- **ユーザーセクション**: 標準テンプレートにないセクションは保持すべき
- **カスタム例**: ユーザーが追加した例は維持すべき
- **コメント**: インラインコメントやノートは保持すべき
- **フォーマット設定**: 既存のマークダウンスタイル選択を尊重

### 更新理念

- **デフォルトで追加的**: 置き換えではなく新しい情報を追加
- **非推奨をマーク**: 取り消し線または[DEPRECATED]タグを使用
- **重要な変更に日付**: 主要変更にタイムスタンプを追加
- **変更を説明**: なぜ何かが更新されたかの簡潔なノート

ゴールは、ユーザーのカスタマイゼーションを尊重しながら現在の状態を保つ生きたドキュメントを維持し、ユーザーが作業を失うことを心配することなく効果的な仕様駆動開発をサポートすることです。
