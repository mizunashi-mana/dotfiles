---
description: Initialize a new specification with detailed project description and requirements
allowed-tools: Bash, Read, Write, Glob
---

# 仕様の初期化

提供されたプロジェクト説明に基づいて新しい仕様を初期化します：

**プロジェクト説明**: $ARGUMENTS

## ステアリングコンテキストの検証

### ステアリング文書の確認

- 構造コンテキスト: @spec/steering/structure.md
- 技術的制約: @spec/steering/tech.md
- プロダクトコンテキスト: @spec/steering/product.md

### ステアリングの存在確認

- ステアリングファイル: !`[ -d spec/steering ] && ls -la spec/steering/ || echo "ステアリングディレクトリが見つかりません - ステアリングコンテキストなしで続行します"`

**柔軟性**: 新機能または空のプロジェクトの場合、ステアリング文書は推奨されますが必須ではありません。ステアリング文書が不足または空の場合、仕様生成フェーズに直接進むことができます。

## タスク: 仕様構造の初期化

**スコープ**: このコマンドは、提供された詳細なプロジェクト説明に基づいてディレクトリ構造とメタデータを初期化します。

### 1. プロジェクト説明の分析

提供された説明（$ARGUMENTS）から以下を抽出：

- プロジェクトの目的と目標
- 主要な機能と機能性
- ターゲットユーザーまたはユースケース
- 技術的要件または制約
- 言及された具体的な実装の詳細

### 2. 機能名の生成

分析に基づいて、プロジェクトの本質を捉えた簡潔で説明的な機能名を作成します。

### 3. 仕様ディレクトリの作成

`spec/specs/{YYYYMMDD形式での日付}_{生成された機能名}/` ディレクトリをテンプレートファイルとともに作成：

- `requirements.md` - ユーザーストーリー用の空のテンプレート
- `design.md` - 技術設計用の空のテンプレート
- `tasks.md` - 実装タスク用の空のテンプレート
- `spec.json` - メタデータと承認追跡

### 4. spec.jsonメタデータの初期化

承認追跡とプロジェクト説明を含む初期メタデータを作成：

```json
{
  "feature_name": "{生成された機能名}",
  "project_description": "$ARGUMENTS",
  "created_at": "現在のタイムスタンプ",
  "updated_at": "現在のタイムスタンプ",
  "language": "japanese",
  "phase": "initialized",
  "approvals": {
    "requirements": {
      "generated": false,
      "approved": false
    },
    "design": {
      "generated": false,
      "approved": false
    },
    "tasks": {
      "generated": false,
      "approved": false
    }
  },
  "ready_for_implementation": false
}
```

### 5. プロジェクトコンテキストを含むテンプレートファイルの作成

#### requirements.md（コンテキスト付きテンプレート）

```markdown
# 要件文書

## プロジェクト概要

{提供された説明に基づくプロジェクトの簡潔な要約}

## プロジェクト説明（ユーザー入力）

$ARGUMENTS

## 要件

<!-- 詳細なユーザーストーリーは/spec:requirementsフェーズで生成されます -->

---

**ステータス**: 要件生成の準備完了
**次のステップ**: `/spec:requirements {機能名}` を実行して詳細な要件を生成
```

#### design.md（空のテンプレート）

```markdown
# 設計文書

## 概要

<!-- 技術設計は要件承認後に生成されます -->

---

**ステータス**: 要件承認待ち
**次のステップ**: 最初に要件を完成させて承認してください
```

#### tasks.md（空のテンプレート）

```markdown
# 実装計画

<!-- 実装タスクは設計承認後に生成されます -->

---

**ステータス**: 設計承認待ち  
**次のステップ**: 最初に設計を完成させて承認してください
```

### 6. CLAUDE.mdリファレンスの更新

生成された機能名と簡潔な説明とともに、新しい仕様をアクティブな仕様リストに追加します。

## 初期化後の次のステップ

**インタラクティブ承認**を使用した適切な仕様駆動開発ワークフローに従います：

**インタラクティブ承認を使用した効率化されたワークフロー：**

1. **要件の生成**: `/spec:requirements {機能名}`
2. **インタラクティブ承認を使用した設計の生成**: `/spec:design {機能名}`
   - プロンプト: "requirements.mdをレビューしましたか？ [y/N]"
   - 'y'の場合: 要件を自動承認して設計を生成
   - 'N'の場合: 手動レビューのために停止
3. **インタラクティブ承認を使用したタスクの生成**: `/spec:tasks {機能名}`
   - 要件と設計の両方のレビューをプロンプト
   - 確認時に両方のフェーズを自動承認
4. **実装の開始**: すべてのフェーズが完了後

**インタラクティブ承認の利点：**

- ✅ **手動のspec.json編集が不要**
- ✅ 確認プロンプトによる**レビューの強制**を維持
- ✅ 即座な進行による**効率化されたワークフロー**
- ✅ 適切なレビューのために停止する能力による**安全性の保持**

**従来の手動承認も利用可能：**
手動制御を好む場合は、フェーズ間でspec.jsonを直接編集することもできます。

## 指示

1. **プロジェクト説明の解析** - 詳細な説明から主要な情報を抽出
2. **適切な機能名の生成** - 簡潔で説明的な名前を作成
3. **ステアリング文書の確認** - 新機能では推奨されるが必須ではない
4. **ディレクトリ構造の作成** - テンプレートにプロジェクトコンテキストを含める
5. プロジェクト説明を含むメタデータで**承認追跡を設定**
6. 生成された機能名を含む**明確な次のステップをユーザーに提供**
7. **柔軟なワークフローを有効化** - 適切な場合は要件への直接進行を許可

## 出力形式

初期化後、以下を提供：

1. 生成された機能名とその根拠
2. 簡潔なプロジェクト要約
3. 作成されたファイルパス
4. 実行する正確なコマンドを含む明確な次のステップ

これにより、各ステップ間の必須レビューフェーズを含む適切な仕様駆動開発ワークフローが保証されます。
