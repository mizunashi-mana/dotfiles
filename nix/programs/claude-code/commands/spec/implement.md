---
description: Do tasks and build product by a specification
allowed-tools: Read, Write, Edit, MultiEdit, Update, WebSearch, WebFetch
---

# 実装

機能の実装を開始: **$ARGUMENTS**

## インタラクティブ承認: タスクレビュー

**重要**: 実装はタスクがレビューおよび承認された後にのみ開始できます。

### タスクレビュープロセス

- 要件文書: @spec/specs/$ARGUMENTS/requirements.md
- 設計文書: @spec/specs/$ARGUMENTS/design.md
- タスク文書: @spec/specs/$ARGUMENTS/tasks.md
- 仕様メタデータ: @spec/specs/$ARGUMENTS/spec.json

**インタラクティブ承認プロセス**:

1. **文書が存在するか確認** - requirements.mdとdesign.md、tasks.mdが生成されていることを確認
2. **要件レビューをプロンプト** - ユーザーに確認: "requirements.mdをレビューしましたか？ [y/N]"
3. **設計レビューをプロンプト** - ユーザーに確認: "design.mdをレビューしましたか？ [y/N]"
4. **設計レビューをプロンプト** - ユーザーに確認: "tasks.mdをレビューしましたか？ [y/N]"
5. **全て'y'（はい）の場合**: spec.jsonを自動的に更新して両方のフェーズを承認し、実装を続行
6. **いずれかが'N'（いいえ）の場合**: 実行を停止し、該当する文書を最初にレビューするようユーザーに指示

**ユーザーがレビューを確認したときのspec.jsonの自動承認更新**:

```json
{
  "approvals": {
    "requirements": {
      "generated": true,
      "approved": true // ← ユーザーが確認したとき自動的にtrueに設定
    },
    "design": {
      "generated": true,
      "approved": true // ← ユーザーが確認したとき自動的にtrueに設定
    },
    "tasks": {
      "generated": true,
      "approved": true // ← ユーザーが確認したとき自動的にtrueに設定
    }
  },
  "phase": "implementing",
  "ready_for_implementation": true
}
```

**ユーザーインタラクションの例**:

```
📋 実装前に要件と設計、タスクのレビューが必要です。
📄 レビューしてください: spec/specs/feature-name/requirements.md
❓ requirements.mdをレビューしましたか？ [y/N]: y
📄 レビューしてください: spec/specs/feature-name/design.md
❓ design.mdをレビューしましたか？ [y/N]: y
📄 レビューしてください: spec/specs/feature-name/tasks.md
❓ tasks.mdをレビューしましたか？ [y/N]: y
✅ 要件と設計、タスクを自動的に承認しました。実装を続行します...
```

## コンテキスト分析

### 完全な仕様コンテキスト（承認済み）

- 要件: @spec/specs/$ARGUMENTS/requirements.md
- 設計: @spec/specs/$ARGUMENTS/design.md
- 現在のタスク: @spec/specs/$ARGUMENTS/tasks.md
- 仕様メタデータ: @spec/specs/$ARGUMENTS/spec.json

### ステアリングコンテキスト

- アーキテクチャパターン: @spec/steering/structure.md
- 開発プラクティス: @spec/steering/tech.md
- プロダクト制約: @spec/steering/product.md

## タスク：実装実行

### 実装プロセスの概要

承認された仕様文書に基づいて、段階的に機能を実装します。

### 1. タスク実行の準備

#### 実行前チェックリスト

1. **仕様文書の確認**
   - `requirements.md`: 機能要件とユーザーストーリーが明確に定義されている
   - `design.md`: 技術設計とアーキテクチャが詳細に記載されている
   - `tasks.md`: 実装タスクが優先順位付きで整理されている
   - `spec.json`: すべてのフェーズが承認済みになっている

2. **開発環境の確認**
   - 必要な依存関係がインストールされている
   - 開発ツールが正しく設定されている
   - テスト環境が準備されている

### 2. タスク実行手順

#### ステップ1: タスクの選択と分析

1. **実行順序の決定**
   - `tasks.md`を上から順に確認
   - チェック済み（✅）のタスクはスキップ
   - 未完了の最初のタスクを選択

2. **タスク内容の詳細分析**
   - タスクの目的と期待される成果を明確化
   - 必要なファイル修正やコード変更を特定
   - 依存関係や前提条件を確認

#### ステップ2: 実装の実行

1. **コード実装**
   - 設計文書に従った実装パターンの適用
   - 既存コードとの整合性を保持
   - 適切なエラーハンドリングの実装

2. **品質確認**
   - コードレビューの実行
   - 静的解析ツールでの検証
   - セキュリティベストプラクティスの適用

#### ステップ3: テストとバリデーション

1. **単体テストの実行**
   - 新規実装部分のテスト作成・実行
   - 既存テストの回帰確認

2. **統合テストの実行**
   - システム全体での動作確認
   - 関連機能との相互作用テスト

#### ステップ4: タスクの完了処理

1. **完了マーキング**
   - `tasks.md`の該当タスクにチェックマーク（✅）を追加
   - 完了日時と実装者のメモを記録

2. **ドキュメント更新**
   - 実装中に発見した設計変更点の記録
   - 追加で必要となったタスクの`tasks.md`への追加

### 3. エラー処理とロールバック

#### 実装エラーの対処

1. **エラーの分類**
   - 設計上の問題: 設計文書の見直しが必要
   - 実装上の問題: コードの修正で対処可能
   - 環境の問題: 開発環境の再設定が必要

2. **対処手順**
   - タスクを一時中断する
   - ユーザに修正方針を確認し、設計文書を更新してもらう

### 4. 進捗報告とコミュニケーション

#### ユーザーへの報告内容

1. **完了したタスクの詳細**
   - 実装した機能の概要
   - 追加されたテストの内容

2. **次のステップの提示**
   - 残りタスクの概要
   - 予想される実装時間
   - ユーザーの確認が必要な項目

#### コミュニケーションのタイミング

- 各タスク完了後の即座の報告
- 重要な設計判断が必要な場合の事前相談
- 予期しない問題が発生した場合の迅速な報告

### 5. 品質保証

#### コード品質基準

1. **コーディング規約の遵守**
   - プロジェクト固有のスタイルガイドライン
   - 言語別ベストプラクティス
   - 可読性とメンテナンス性の確保

2. **テストカバレッジ**
   - 新機能の適切なテスト範囲
   - エッジケースの考慮
   - パフォーマンステストの実行

#### セキュリティ考慮事項

- 入力値の検証とサニタイゼーション
- 認証・認可の適切な実装
- 機密情報の安全な取り扱い

### 6. 完了基準

タスクは以下の条件を満たした時に完了とします：

1. **機能要件の充足**: requirements.mdで定義された全ての要件が実装されている
2. **設計仕様の遵守**: design.mdで定義されたアーキテクチャに沿って実装されている
3. **テストの成功**: 全ての関連テストが正常に通過している
4. **ドキュメントの更新**: 実装に伴う変更が適切に文書化されている
5. **ユーザーの承認**: 実装結果がユーザーに確認され、承認されている
