#!/usr/bin/env bash

set -euo pipefail
[ "${TRACE:-false}" = "true" ] && set -x

SCRIPT_DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
TASKS_DIR="$SCRIPT_DIR/tasks"

"$TASKS_DIR/nix/install"

HOSTNAME_SHORT="$(hostname --short)"

case "$HOSTNAME_SHORT" in
  "macbook-air-2nd")
    nix run nix-darwin \
      --extra-experimental-features 'flakes nix-command' \
      -- switch --flake ".#$HOSTNAME_SHORT" --show-trace
    ;;
  *)
    echo "Unknown host."
    exit 1
    ;;
esac
